{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OSM Tile Generator Configuration",
  "description": "Configuration schema for OSM tile generation projects",
  "type": "object",
  "required": ["name", "pbf_path", "render_type", "zoom_levels"],
  "properties": {
    "name": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "minLength": 1,
      "maxLength": 50,
      "description": "Project name (alphanumeric, underscore, dash only)"
    },
    "description": {
      "type": "string",
      "maxLength": 200,
      "description": "Project description"
    },
    "pbf_path": {
      "type": "string",
      "pattern": "^/pbf/.+\\.osm\\.pbf$",
      "description": "Path to PBF file (must start with /pbf/ and end with .osm.pbf)"
    },
    "render_type": {
      "type": "string",
      "enum": ["full", "bbox"],
      "description": "Render type: full (entire PBF) or bbox (specific area)"
    },
    "bbox": {
      "type": "object",
      "required": ["min_lon", "min_lat", "max_lon", "max_lat"],
      "properties": {
        "min_lon": {
          "type": "number",
          "minimum": -180,
          "maximum": 180,
          "description": "Minimum longitude"
        },
        "min_lat": {
          "type": "number",
          "minimum": -90,
          "maximum": 90,
          "description": "Minimum latitude"
        },
        "max_lon": {
          "type": "number",
          "minimum": -180,
          "maximum": 180,
          "description": "Maximum longitude"
        },
        "max_lat": {
          "type": "number",
          "minimum": -90,
          "maximum": 90,
          "description": "Maximum latitude"
        }
      },
      "description": "Bounding box coordinates (required for bbox render_type)"
    },
    "zoom_levels": {
      "type": "object",
      "required": ["min_zoom", "max_zoom"],
      "properties": {
        "min_zoom": {
          "type": "integer",
          "minimum": 0,
          "maximum": 20,
          "description": "Minimum zoom level"
        },
        "max_zoom": {
          "type": "integer",
          "minimum": 0,
          "maximum": 20,
          "description": "Maximum zoom level"
        }
      },
      "description": "Zoom level range"
    },
    "style": {
      "type": "string",
      "enum": ["osm-carto"],
      "default": "osm-carto",
      "description": "Map style"
    },
    "output_format": {
      "type": "string",
      "enum": ["png"],
      "default": "png",
      "description": "Output tile format"
    },
    "tile_size": {
      "type": "integer",
      "enum": [256, 512],
      "default": 256,
      "description": "Tile size in pixels"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Creation timestamp"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "Last update timestamp"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": { "render_type": { "const": "bbox" } }
      },
      "then": {
        "required": ["bbox"]
      }
    },
    {
      "properties": {
        "zoom_levels": {
          "properties": {
            "min_zoom": true,
            "max_zoom": true
          },
          "additionalProperties": false
        }
      }
    }
  ]
}